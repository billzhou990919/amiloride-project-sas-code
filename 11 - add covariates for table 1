proc sql;
    create table cms.all_op_claims_2015 as
    select bene_id, clm_from_dt, prncpal_dgns_cd, icd_dgns_cd1, icd_dgns_cd2, icd_dgns_cd3, icd_dgns_cd4,icd_dgns_cd5
,icd_dgns_cd6, icd_dgns_cd7, icd_dgns_cd8, icd_dgns_cd9, icd_dgns_cd10, icd_dgns_cd11, icd_dgns_cd12, icd_dgns_cd13, icd_dgns_cd14,
icd_dgns_cd15, icd_dgns_cd16, icd_dgns_cd17, icd_dgns_cd18, icd_dgns_cd19, icd_dgns_cd20, icd_dgns_cd21, icd_dgns_cd22,
icd_dgns_cd23, icd_dgns_cd24, icd_dgns_cd25 from op15.outpatient_base_claims_k_2015
    where bene_id in (select bene_id from cms.study_cohort_v2);
Quit;
proc sql;
    create table cms.all_op_claims_2016 as
    select bene_id, clm_from_dt, prncpal_dgns_cd, icd_dgns_cd1, icd_dgns_cd2, icd_dgns_cd3, icd_dgns_cd4,icd_dgns_cd5
,icd_dgns_cd6, icd_dgns_cd7, icd_dgns_cd8, icd_dgns_cd9, icd_dgns_cd10, icd_dgns_cd11, icd_dgns_cd12, icd_dgns_cd13, icd_dgns_cd14,
icd_dgns_cd15, icd_dgns_cd16, icd_dgns_cd17, icd_dgns_cd18, icd_dgns_cd19, icd_dgns_cd20, icd_dgns_cd21, icd_dgns_cd22,
icd_dgns_cd23, icd_dgns_cd24, icd_dgns_cd25 from op16.outpatient_base_claims_k_2016
    where bene_id in (select bene_id from cms.study_cohort_v2);
Quit;
proc sql;
    create table cms.all_op_claims_2017 as
    select bene_id, clm_from_dt, prncpal_dgns_cd, icd_dgns_cd1, icd_dgns_cd2, icd_dgns_cd3, icd_dgns_cd4,icd_dgns_cd5
,icd_dgns_cd6, icd_dgns_cd7, icd_dgns_cd8, icd_dgns_cd9, icd_dgns_cd10, icd_dgns_cd11, icd_dgns_cd12, icd_dgns_cd13, icd_dgns_cd14,
icd_dgns_cd15, icd_dgns_cd16, icd_dgns_cd17, icd_dgns_cd18, icd_dgns_cd19, icd_dgns_cd20, icd_dgns_cd21, icd_dgns_cd22,
icd_dgns_cd23, icd_dgns_cd24, icd_dgns_cd25 from op17.outpatient_base_claims_k_2017
    where bene_id in (select bene_id from cms.study_cohort_v2);
Quit;
proc sql;
    create table cms.all_op_claims_2018 as
    select bene_id, clm_from_dt, prncpal_dgns_cd, icd_dgns_cd1, icd_dgns_cd2, icd_dgns_cd3, icd_dgns_cd4,icd_dgns_cd5
,icd_dgns_cd6, icd_dgns_cd7, icd_dgns_cd8, icd_dgns_cd9, icd_dgns_cd10, icd_dgns_cd11, icd_dgns_cd12, icd_dgns_cd13, icd_dgns_cd14,
icd_dgns_cd15, icd_dgns_cd16, icd_dgns_cd17, icd_dgns_cd18, icd_dgns_cd19, icd_dgns_cd20, icd_dgns_cd21, icd_dgns_cd22,
icd_dgns_cd23, icd_dgns_cd24, icd_dgns_cd25 from op18.outpatient_base_claims_k_2018
    where bene_id in (select bene_id from cms.study_cohort_v2);
Quit;
proc sql;
    create table cms.all_op_claims_2019 as
    select bene_id, clm_from_dt, prncpal_dgns_cd, icd_dgns_cd1, icd_dgns_cd2, icd_dgns_cd3, icd_dgns_cd4,icd_dgns_cd5
,icd_dgns_cd6, icd_dgns_cd7, icd_dgns_cd8, icd_dgns_cd9, icd_dgns_cd10, icd_dgns_cd11, icd_dgns_cd12, icd_dgns_cd13, icd_dgns_cd14,
icd_dgns_cd15, icd_dgns_cd16, icd_dgns_cd17, icd_dgns_cd18, icd_dgns_cd19, icd_dgns_cd20, icd_dgns_cd21, icd_dgns_cd22,
icd_dgns_cd23, icd_dgns_cd24, icd_dgns_cd25 from op19.outpatient_base_claims_2019
    where bene_id in (select bene_id from cms.study_cohort_v2);
Quit;


proc sql;
    create table cms.all_ip_claims_2015 as
    select bene_id, clm_from_dt, admtg_dgns_cd, prncpal_dgns_cd, icd_dgns_cd1, icd_dgns_cd2, icd_dgns_cd3, icd_dgns_cd4,icd_dgns_cd5
,icd_dgns_cd6, icd_dgns_cd7, icd_dgns_cd8, icd_dgns_cd9, icd_dgns_cd10, icd_dgns_cd11, icd_dgns_cd12, icd_dgns_cd13, icd_dgns_cd14,
icd_dgns_cd15, icd_dgns_cd16, icd_dgns_cd17, icd_dgns_cd18, icd_dgns_cd19, icd_dgns_cd20, icd_dgns_cd21, icd_dgns_cd22,
icd_dgns_cd23, icd_dgns_cd24, icd_dgns_cd25 from ip15.inpatient_base_claims_k_2015
    where bene_id in (select bene_id from cms.study_cohort_v2);
Quit;
proc sql;
    create table cms.all_ip_claims_2016 as
    select bene_id, clm_from_dt, admtg_dgns_cd,  prncpal_dgns_cd, icd_dgns_cd1, icd_dgns_cd2, icd_dgns_cd3, icd_dgns_cd4,icd_dgns_cd5
,icd_dgns_cd6, icd_dgns_cd7, icd_dgns_cd8, icd_dgns_cd9, icd_dgns_cd10, icd_dgns_cd11, icd_dgns_cd12, icd_dgns_cd13, icd_dgns_cd14,
icd_dgns_cd15, icd_dgns_cd16, icd_dgns_cd17, icd_dgns_cd18, icd_dgns_cd19, icd_dgns_cd20, icd_dgns_cd21, icd_dgns_cd22,
icd_dgns_cd23, icd_dgns_cd24, icd_dgns_cd25 from ip16.inpatient_base_claims_k_2016
    where bene_id in (select bene_id from cms.study_cohort_v2);
Quit;
proc sql;
    create table cms.all_ip_claims_2017 as
    select bene_id, clm_from_dt, admtg_dgns_cd, prncpal_dgns_cd, icd_dgns_cd1, icd_dgns_cd2, icd_dgns_cd3, icd_dgns_cd4,icd_dgns_cd5
,icd_dgns_cd6, icd_dgns_cd7, icd_dgns_cd8, icd_dgns_cd9, icd_dgns_cd10, icd_dgns_cd11, icd_dgns_cd12, icd_dgns_cd13, icd_dgns_cd14,
icd_dgns_cd15, icd_dgns_cd16, icd_dgns_cd17, icd_dgns_cd18, icd_dgns_cd19, icd_dgns_cd20, icd_dgns_cd21, icd_dgns_cd22,
icd_dgns_cd23, icd_dgns_cd24, icd_dgns_cd25 from ip17.inpatient_base_claims_k_2017
    where bene_id in (select bene_id from cms.study_cohort_v2);
Quit;
proc sql;
    create table cms.all_ip_claims_2018 as
    select bene_id, clm_from_dt, admtg_dgns_cd, prncpal_dgns_cd, icd_dgns_cd1, icd_dgns_cd2, icd_dgns_cd3, icd_dgns_cd4,icd_dgns_cd5
,icd_dgns_cd6, icd_dgns_cd7, icd_dgns_cd8, icd_dgns_cd9, icd_dgns_cd10, icd_dgns_cd11, icd_dgns_cd12, icd_dgns_cd13, icd_dgns_cd14,
icd_dgns_cd15, icd_dgns_cd16, icd_dgns_cd17, icd_dgns_cd18, icd_dgns_cd19, icd_dgns_cd20, icd_dgns_cd21, icd_dgns_cd22,
icd_dgns_cd23, icd_dgns_cd24, icd_dgns_cd25 from ip18.inpatient_base_claims_k_2018
    where bene_id in (select bene_id from cms.study_cohort_v2);
Quit;
proc sql;
    create table cms.all_ip_claims_2019 as
    select bene_id, clm_from_dt, admtg_dgns_cd, prncpal_dgns_cd, icd_dgns_cd1, icd_dgns_cd2, icd_dgns_cd3, icd_dgns_cd4,icd_dgns_cd5
,icd_dgns_cd6, icd_dgns_cd7, icd_dgns_cd8, icd_dgns_cd9, icd_dgns_cd10, icd_dgns_cd11, icd_dgns_cd12, icd_dgns_cd13, icd_dgns_cd14,
icd_dgns_cd15, icd_dgns_cd16, icd_dgns_cd17, icd_dgns_cd18, icd_dgns_cd19, icd_dgns_cd20, icd_dgns_cd21, icd_dgns_cd22,
icd_dgns_cd23, icd_dgns_cd24, icd_dgns_cd25 from ip19.inpatient_base_claims_2019
    where bene_id in (select bene_id from cms.study_cohort_v2);
Quit;


data cms.outpatient;
    set cms.all_op_claims_2015 cms.all_op_claims_2016 cms.all_op_claims_2017 cms.all_op_claims_2018 cms.all_op_claims_2019;
run;

data cms.inpatient;
    set cms.all_ip_claims_2015 cms.all_ip_claims_2016 cms.all_ip_claims_2017 cms.all_ip_claims_2018 cms.all_ip_claims_2019;
run;

proc sql;
    create table cms.outpatient as
    select a.*, b.index_date
    from cms.outpatient as a
    left join cms.study_cohort_v2 as b
    on a.bene_id = b.bene_id;
quit;
proc sql;
    create table cms.inpatient as
    select a.*, b.index_date
    from cms.inpatient as a
    left join cms.study_cohort_v2 as b
    on a.bene_id = b.bene_id;
quit;


///////////////MI//////////////////
data flag_MI;
    set cms.outpatient;
    if (0 <= (index_date - clm_from_dt) <=180) and (prncpal_dgns_cd in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd1 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd2 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd3 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') 
or 
        icd_dgns_cd4 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd5 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd6 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739')
or 
        icd_dgns_cd7 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd8 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd9 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739')
or 
        icd_dgns_cd10 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd11 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd12 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739')
or 
        icd_dgns_cd13 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd14 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd15 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739')
or 
        icd_dgns_cd16 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd17 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd18 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739')
or 
        icd_dgns_cd19 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd20 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd21 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739')
or 
        icd_dgns_cd22 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd23 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd24 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739')
or 
        icd_dgns_cd25 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739')) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_MI nodupkey;
    by bene_id;
    where flag = 1;
run;
data flag_MI_ip;
    set cms.inpatient;
    if (0 <= (index_date - clm_from_dt) <=180) and (admtg_dgns_cd in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or
prncpal_dgns_cd in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd1 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd2 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd3 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') 
or 
        icd_dgns_cd4 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd5 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd6 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739')
or 
        icd_dgns_cd7 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd8 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd9 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739')
or 
        icd_dgns_cd10 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd11 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd12 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739')
or 
        icd_dgns_cd13 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd14 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd15 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739')
or 
        icd_dgns_cd16 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd17 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd18 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739')
or 
        icd_dgns_cd19 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd20 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd21 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739')
or 
        icd_dgns_cd22 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd23 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739') or 
        icd_dgns_cd24 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739')
or 
        icd_dgns_cd25 in: ('412','410','44020','44021','44022','44023','44024','44029', '44030','44031','44032','4439','444','445','440','I21', 'I23','I700','I702','I703','I704','I705','I706','I707','I708','I709','I71','I739')) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_MI_ip nodupkey;
    by bene_id;
    where flag = 1;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_MI(in=b);
    by bene_id;
    if b then MI_op = 1;
    else MI_op = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_MI_ip(in=b);
    by bene_id;
    if b then MI_ip = 1;
    else MI_ip = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    set cms.study_cohort_v2;
    if (MI_ip = 1 or MI_op = 1) then MI = 1; else MI = 0;
    drop MI_ip MI_op;
run;
////////////////CHF//////////////////
data flag_CHF;
    set cms.outpatient;
    if (0 <= (index_date - clm_from_dt) <=180) and (prncpal_dgns_cd in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd1 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd2 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd3 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') 
or 
        icd_dgns_cd4 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd5 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd6 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50')
or 
        icd_dgns_cd7 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd8 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd9 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50')
or 
        icd_dgns_cd10 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd11 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd12 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50')
or 
        icd_dgns_cd13 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd14 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd15 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50')
or 
        icd_dgns_cd16 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd17 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd18 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50')
or 
        icd_dgns_cd19 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd20 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd21 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50')
or 
        icd_dgns_cd22 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd23 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd24 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50')
or 
        icd_dgns_cd25 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50')) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_CHF nodupkey;
    by bene_id;
    where flag = 1;
run;
data flag_CHF_ip;
    set cms.inpatient;
    if (0 <= (index_date - clm_from_dt) <=180) and (admtg_dgns_cd in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or
prncpal_dgns_cd in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd1 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd2 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd3 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') 
or 
        icd_dgns_cd4 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd5 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd6 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50')
or 
        icd_dgns_cd7 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd8 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd9 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50')
or 
        icd_dgns_cd10 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd11 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd12 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50')
or 
        icd_dgns_cd13 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd14 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd15 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50')
or 
        icd_dgns_cd16 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd17 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd18 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50')
or 
        icd_dgns_cd19 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd20 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd21 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50')
or 
        icd_dgns_cd22 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd23 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50') or 
        icd_dgns_cd24 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50')
or 
        icd_dgns_cd25 in: ('39891','40201','40211', '40291', '40401', '40411', '40403', '40413', '40491', '40493', 'I110', 'I130', 'I132', '428', 'I50')) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_CHF_ip nodupkey;
    by bene_id;
    where flag = 1;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_CHF(in=b);
    by bene_id;
    if b then CHF_op = 1;
    else CHF_op = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_CHF_ip(in=b);
    by bene_id;
    if b then CHF_ip = 1;
    else CHF_ip = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    set cms.study_cohort_v2;
    if (CHF_ip = 1 or CHF_op = 1) then CHF = 1; else CHF = 0;
    drop CHF_ip CHF_op;
run;
////////////////PVD/////////////////
data flag_PVD;
    set cms.outpatient;
    if (0 <= (index_date - clm_from_dt) <=180) and (prncpal_dgns_cd in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd1 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd2 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd3 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') 
or 
        icd_dgns_cd4 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd5 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd6 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959')
or 
        icd_dgns_cd7 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd8 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd9 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959')
or 
        icd_dgns_cd10 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd11 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd12 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959')
or 
        icd_dgns_cd13 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd14 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd15 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959')
or 
        icd_dgns_cd16 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd17 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd18 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959')
or 
        icd_dgns_cd19 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd20 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd21 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959')
or 
        icd_dgns_cd22 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd23 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd24 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959')
or 
        icd_dgns_cd25 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959')) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_PVD nodupkey;
    by bene_id;
    where flag = 1;
run;
data flag_PVD_ip;
    set cms.inpatient;
    if (0 <= (index_date - clm_from_dt) <=180) and (admtg_dgns_cd in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or
prncpal_dgns_cd in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd1 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd2 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd3 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') 
or 
        icd_dgns_cd4 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd5 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd6 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959')
or 
        icd_dgns_cd7 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd8 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd9 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959')
or 
        icd_dgns_cd10 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd11 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd12 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959')
or 
        icd_dgns_cd13 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd14 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd15 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959')
or 
        icd_dgns_cd16 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd17 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd18 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959')
or 
        icd_dgns_cd19 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd20 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd21 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959')
or 
        icd_dgns_cd22 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd23 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959') or 
        icd_dgns_cd24 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959')
or 
        icd_dgns_cd25 in: ('0930','4373','440','441','443','4471','5571','5579','V434','I70','I71','I731','I738','I739','I771','I790','I792','K551','K558','K559','Z958','Z959')) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_PVD_ip nodupkey;
    by bene_id;
    where flag = 1;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_PVD(in=b);
    by bene_id;
    if b then PVD_op = 1;
    else PVD_op = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_PVD_ip(in=b);
    by bene_id;
    if b then PVD_ip = 1;
    else PVD_ip = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    set cms.study_cohort_v2;
    if (PVD_ip = 1 or PVD_op = 1) then PVD = 1; else PVD = 0;
    drop PVD_ip PVD_op;
run;

/////////////////cerebro///////////////
data flag_cerebro;
    set cms.outpatient;
    if (0 <= (index_date - clm_from_dt) <=180) and (prncpal_dgns_cd in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd1 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd2 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd3 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') 
or 
        icd_dgns_cd4 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd5 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd6 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438')
or 
        icd_dgns_cd7 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd8 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd9 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438')
or 
        icd_dgns_cd10 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd11 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd12 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438')
or 
        icd_dgns_cd13 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd14 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd15 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438')
or 
        icd_dgns_cd16 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd17 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd18 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438')
or 
        icd_dgns_cd19 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd20 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd21 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438')
or 
        icd_dgns_cd22 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd23 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd24 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438')
or 
        icd_dgns_cd25 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438')) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_cerebro nodupkey;
    by bene_id;
    where flag = 1;
run;
data flag_cerebro_ip;
    set cms.inpatient;
    if (0 <= (index_date - clm_from_dt) <=180) and (admtg_dgns_cd in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or
prncpal_dgns_cd in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd1 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd2 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd3 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') 
or 
        icd_dgns_cd4 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd5 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd6 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438')
or 
        icd_dgns_cd7 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd8 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd9 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438')
or 
        icd_dgns_cd10 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd11 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd12 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438')
or 
        icd_dgns_cd13 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd14 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd15 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438')
or 
        icd_dgns_cd16 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd17 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd18 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438')
or 
        icd_dgns_cd19 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd20 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd21 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438')
or 
        icd_dgns_cd22 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd23 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438') or 
        icd_dgns_cd24 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438')
or 
        icd_dgns_cd25 in: ('G45','G46','H340','I60','I61','I62','I63', 'I64','I65','I66','I67','I68','I69','36234','430','431','432','433','434','435','436','437','438')) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_cerebro_ip nodupkey;
    by bene_id;
    where flag = 1;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_cerebro(in=b);
    by bene_id;
    if b then cerebro_op = 1;
    else cerebro_op = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_cerebro_ip(in=b);
    by bene_id;
    if b then cerebro_ip = 1;
    else cerebro_ip = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    set cms.study_cohort_v2;
    if (cerebro_ip = 1 or cerebro_op = 1) then cerebro = 1; else cerebro = 0;
    drop cerebro_ip cerebro_op;
run;

/////////////////////dementia///////////////
/*Dementia*/
data flag_dementia;
    set cms.outpatient;
    if (0 <= (index_date - svcdate) <=365) and (dx1 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or 
        dx2 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or 
        dx3 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or 
        dx4 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_dementia nodupkey;
    by bene_id;
    where flag = 1;
run;
data flag_dementia_ip;
    set cms.inpatient;
    if (0 <= (index_date - clm_from_dt) <=365) and (dx1 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or 
        dx2 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or 
        dx3 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or 
        dx4 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or
        dx5 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or
        dx6 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or
        dx7 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or
        dx8 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or
        dx9 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or
        dx10 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or
        dx11 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or
        dx12 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or
        dx13 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or
        dx14 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')   or
        dx15 in: ('290','2941','3312','F00','F01','F02','F03','G30','F051','G311')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_dementia_ip nodupkey;
    by bene_id;
    where flag = 1;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_dementia(in=b);
    by bene_id;
    if b then dementia_op = 1;
    else dementia_op = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_dementia_ip(in=b);
    by bene_id;
    if b then dementia_ip = 1;
    else dementia_ip = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    set cms.study_cohort_v2;
    if (dementia_ip = 1 or dementia_op = 1) then dementia = 1; else dementia = 0;
    drop dementia_ip dementia_op;
run;

/////////////////COPD//////////////////
/*COPD*/
data flag_copd;
    set cms.outpatient;
    if (0 <= (index_date - svcdate) <=365) and (dx1 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63',
                         'J64','J65','J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or 
        dx2 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63', 
'J64','J65','J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or 
        dx3 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63',
'J64','J65','J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or 
        dx4 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63', 
'J64','J65','J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_copd nodupkey;
    by bene_id;
    where flag = 1;
run;
data flag_copd_ip;
    set cms.inpatient;
    if (0 <= (index_date - clm_from_dt) <=365) and (dx1 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47',
'J60','J61','J62','J63',  'J64','J65','J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or 
        dx2 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63','J64','J65',
'J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or 
        dx3 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63','J64','J65',
'J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or 
        dx4 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63', 'J64','J65',
'J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or
        dx5 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63', 'J64','J65',
'J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or
        dx6 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63','J64','J65',
'J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or
        dx7 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63','J64','J65',
'J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or
        dx8 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63','J64','J65',
'J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or
        dx9 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63', 'J64','J65',
'J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or
        dx10 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63', 'J64','J65',
'J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or
        dx11 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63', 'J64','J65',
'J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or
        dx12 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63',  'J64','J65',
'J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or
        dx13 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63',   'J64','J65',
'J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or
        dx14 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63',  'J64','J65',
'J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')   or
        dx15 in: ('I278','I279','J684','J701','J703','J40','J41','J42','J43','J44','J45','J46','J47','J60','J61','J62','J63',   'J64','J65',
'J66','J67','4168','4169','5064','5081', '5088','490','491','492','493','494','495','496','500','501','502','503','504','505')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_copd_ip nodupkey;
    by bene_id;
    where flag = 1;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_copd(in=b);
    by bene_id;
    if b then copd_op = 1;
    else copd_op = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_copd_ip(in=b);
    by bene_id;
    if b then copd_ip = 1;
    else copd_ip = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    set cms.study_cohort_v2;
    if (copd_ip = 1 or copd_op = 1) then copd = 1; else copd = 0;
    drop copd_ip copd_op;
run;

/////////////rheumatologic///////////////////
/*rheumatologic*/
data flag_rheumatologic;
    set cms.outpatient;
    if (0 <= (index_date - svcdate) <=365) and (dx1 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or 
        dx2 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or 
        dx3 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or 
        dx4 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_rheumatologic nodupkey;
    by bene_id;
    where flag = 1;
run;
data flag_rheumatologic_ip;
    set cms.inpatient;
    if (0 <= (index_date - clm_from_dt) <=365) and (dx1 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or 
        dx2 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or 
        dx3 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or 
        dx4 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or
        dx5 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or
        dx6 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or
        dx7 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or
        dx8 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or
        dx9 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or
        dx10 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or
        dx11 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or
        dx12 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or
        dx13 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or
        dx14 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')   or
        dx15 in: ('7100','7101','7102','7103','7104','7148','725','M05','M32','M33','M34','M06','M315','M351','M353','M360','7140','7141','7142')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_rheumatologic_ip nodupkey;
    by bene_id;
    where flag = 1;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_rheumatologic(in=b);
    by bene_id;
    if b then rheumatologic_op = 1;
    else rheumatologic_op = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_rheumatologic_ip(in=b);
    by bene_id;
    if b then rheumatologic_ip = 1;
    else rheumatologic_ip = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    set cms.study_cohort_v2;
    if (rheumatologic_ip = 1 or rheumatologic_op = 1) then rheumatologic = 1; else rheumatologic = 0;
    drop rheumatologic_ip rheumatologic_op;
run;

///////////////peptic ulcer//////////////
/*Peptic Ulcer disease*/
data flag_ulcer;
    set cms.outpatient;
    if (0 <= (index_date - svcdate) <=365) and (dx1 in: ('K25','K26','K27','K28','531','532','533','534')   or 
        dx2 in: ('K25','K26','K27','K28','531','532','533','534')   or 
        dx3 in: ('K25','K26','K27','K28','531','532','533','534')   or 
        dx4 in: ('K25','K26','K27','K28','531','532','533','534')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_ulcer nodupkey;
    by bene_id;
    where flag = 1;
run;
data flag_ulcer_ip;
    set cms.inpatient;
    if (0 <= (index_date - clm_from_dt) <=365) and (dx1 in: ('K25','K26','K27','K28','531','532','533','534')   or 
        dx2 in: ('K25','K26','K27','K28','531','532','533','534')   or 
        dx3 in: ('K25','K26','K27','K28','531','532','533','534')   or 
        dx4 in: ('K25','K26','K27','K28','531','532','533','534')   or
        dx5 in: ('K25','K26','K27','K28','531','532','533','534')   or
        dx6 in: ('K25','K26','K27','K28','531','532','533','534')   or
        dx7 in: ('K25','K26','K27','K28','531','532','533','534')   or
        dx8 in: ('K25','K26','K27','K28','531','532','533','534')   or
        dx9 in: ('K25','K26','K27','K28','531','532','533','534')   or
        dx10 in: ('K25','K26','K27','K28','531','532','533','534')   or
        dx11 in: ('K25','K26','K27','K28','531','532','533','534')   or
        dx12 in: ('K25','K26','K27','K28','531','532','533','534')   or
        dx13 in: ('K25','K26','K27','K28','531','532','533','534')   or
        dx14 in: ('K25','K26','K27','K28','531','532','533','534')   or
        dx15 in: ('K25','K26','K27','K28','531','532','533','534')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_ulcer_ip nodupkey;
    by bene_id;
    where flag = 1;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_ulcer(in=b);
    by bene_id;
    if b then ulcer_op = 1;
    else ulcer_op = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_ulcer_ip(in=b);
    by bene_id;
    if b then ulcer_ip = 1;
    else ulcer_ip = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    set cms.study_cohort_v2;
    if (ulcer_ip = 1 or ulcer_op = 1) then ulcer = 1; else ulcer = 0;
    drop ulcer_ip ulcer_op;
run;
//////////////////////liver///////////////
/*Liver disease*/
data flag_liver;
    set cms.outpatient;
    if (0 <= (index_date - svcdate) <=365) and (dx1 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or 
        dx2 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or 
        dx3 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or 
        dx4 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_liver nodupkey;
    by bene_id;
    where flag = 1;
run;
data flag_liver_ip;
    set cms.inpatient;
    if (0 <= (index_date - clm_from_dt) <=365) and (dx1 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or 
        dx2 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or 
        dx3 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or 
        dx4 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or
        dx5 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or
        dx6 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or
        dx7 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or
        dx8 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or
        dx9 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or
        dx10 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or
        dx11 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or
        dx12 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or
        dx13 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or
        dx14 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')   or
        dx15 in: ('070','571','572','573','5768','4560','4561','4562','1550','1551', '1552', 'B15', 'B16', 'B17', 'B18', 'B19', 'C22', 'K70', 'K71', 'K72', 'K73', 'K74', 'K75', 'K76', 'K77', 'Z944', 'I982', 'D684C', 'Q618A')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_liver_ip nodupkey;
    by bene_id;
    where flag = 1;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_liver(in=b);
    by bene_id;
    if b then liver_op = 1;
    else liver_op = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_liver_ip(in=b);
    by bene_id;
    if b then liver_ip = 1;
    else liver_ip = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    set cms.study_cohort_v2;
    if (liver_ip = 1 or liver_op = 1) then liver = 1; else liver = 0;
    drop liver_ip liver_op;
run;
/////////////////diabetes///////////
data flag_diabetes;
    set cms.outpatient;
    if (0 <= (index_date - clm_from_dt) <=180) and (dx1 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or 
        dx2 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or 
        dx3 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or 
        dx4 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13')) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_diabetes nodupkey;
    by bene_id;
    where flag = 1;
run;
data flag_diabetes_ip;
    set cms.inpatient;
    if (0 <= (index_date - clm_from_dt) <=180) and (dx1 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or 
        dx2 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or 
        dx3 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or 
        dx4 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or
        dx5 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or
        dx6 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or
        dx7 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or
        dx8 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or
        dx9 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or
        dx10 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or
        dx11 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or
        dx12 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or
        dx13 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or
        dx14 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13') or
        dx15 in: ('250', 'E08', 'E09', 'E10', 'E11', 'E13')) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_diabetes_ip nodupkey;
    by bene_id;
    where flag = 1;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_diabetes(in=b);
    by bene_id;
    if b then diabetes_op = 1;
    else diabetes_op = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_diabetes_ip(in=b);
    by bene_id;
    if b then diabetes_ip = 1;
    else diabetes_ip = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    set cms.study_cohort_v2;
    if (diabetes_ip = 1 or diabetes_op = 1) then diabetes = 1; else diabetes = 0;
    drop diabetes_ip diabetes_op;
run;

///////////////////renal/kidney disease//////////////
/*Chronic Kidney Disease*/
data flag_ckd;
    set cms.outpatient;
    if (0 <= (index_date - svcdate) <=365) and (dx1 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or 
        dx2 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or 
        dx3 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or 
        dx4 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_ckd nodupkey;
    by bene_id;
    where flag = 1;
run;
data flag_ckd_ip;
    set cms.inpatient;
    if (0 <= (index_date - clm_from_dt) <=365) and (dx1 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or 
        dx2 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or 
        dx3 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or 
        dx4 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or
        dx5 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or
        dx6 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or
        dx7 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or
        dx8 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or
        dx9 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or
        dx10 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or
        dx11 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or
        dx12 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or
        dx13 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or
        dx14 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')   or
        dx15 in: ('580','581','582', '583', '584', '585', '586', '587',  'N02', 'N03', 'N04', 'N05', 'N06', 'N07', 'N08', 'N11',  'N12',  'N14', 'N18', 'N19', 'N26', 'N158', 'N159',  'N160', 'N162', 'N163', 'N164', 'N168', 'Q612',  'Q613', 'Q615', 'Q619', 'E102', 'E112',  'E132',  'E142', 'I120', 'M300', 'M313', 'M319', 'M321B')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_ckd_ip nodupkey;
    by bene_id;
    where flag = 1;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_ckd(in=b);
    by bene_id;
    if b then ckd_op = 1;
    else ckd_op = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_ckd_ip(in=b);
    by bene_id;
    if b then ckd_ip = 1;
    else ckd_ip = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    set cms.study_cohort_v2;
    if (ckd_ip = 1 or ckd_op = 1) then ckd = 1; else ckd = 0;
    drop ckd_ip ckd_op;
run;
/////////////solid tumor/////////////
/*Solid tumor*/
data flag_solidtumor;
    set cms.outpatient;
    if (0 <= (index_date - svcdate) <=365) and (dx1 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or 
        dx2 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or 
        dx3 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or 
        dx4 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_solidtumor nodupkey;
    by bene_id;
    where flag = 1;
run;
data flag_solidtumor_ip;
    set cms.inpatient;
    if (0 <= (index_date - clm_from_dt) <=365) and (dx1 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or 
        dx2 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or 
        dx3 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or 
        dx4 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or
        dx5 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or
        dx6 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or
        dx7 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or
        dx8 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or
        dx9 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or
        dx10 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or
        dx11 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or
        dx12 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or
        dx13 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or
        dx14 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')   or
        dx15 in: ('C77','C78','C79','C800','C801','C802','196','197','198','1990','1991','1992')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_solidtumor_ip nodupkey;
    by bene_id;
    where flag = 1;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_solidtumor(in=b);
    by bene_id;
    if b then solidtumor_op = 1;
    else solidtumor_op = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_solidtumor_ip(in=b);
    by bene_id;
    if b then solidtumor_ip = 1;
    else solidtumor_ip = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    set cms.study_cohort_v2;
    if (solidtumor_ip = 1 or solidtumor_op = 1) then solidtumor = 1; else solidtumor = 0;
    drop solidtumor_ip solidtumor_op;
run;

//////////////////leukimia/maglinancy//////////////
/*malignancy*/
data flag_malignancy;
    set cms.outpatient;
    if (0 <= (index_date - svcdate) <=365) and (dx1 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11',
                         'C12','C13','C14','C15','C16','C17','C18','C19','C20','C21','C22','C23',
                         'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40',
                         'C41','C43','C45','C46','C47','C48','C49','C50','C51','C52','C53','C54',
                         'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65','C66','C67',
                         'C68','C69','C70','C71','C72','C73','C74','C75','C76','C81','C82','C83',
                         'C84','C85','C88','C90','C91','C92','C93','C94','C95','C96','C97','14','15','16','170','171','172','200',
'201','202','203','204','205','206','207','208','174','175','176','177','178','179','18','190','191','192','193','194','195')   or 
        dx2 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 
'C12','C13','C14','C15','C16','C17','C18','C19','C20','C21','C22','C23',  
'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40',  
'C41','C43','C45','C46','C47','C48','C49','C50','C51','C52','C53','C54',  
'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65','C66','C67', 
'C68','C69','C70','C71','C72','C73','C74','C75','C76','C81','C82','C83',
'C84','C85','C88','C90','C91','C92','C93','C94','C95','C96','C97','14','15','16','170','171','172','200', '201','202','203',
'204','205','206','207','208','174','175','176','177','178','179','18','190','191','192','193','194','195')   or 
        dx3 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 'C12','C13','C14','C15','C16',
'C17','C18','C19','C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40','C41','C43',
'C45','C46','C47','C48','C49','C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65',
'C66','C67', 'C68','C69','C70','C71','C72','C73','C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92','C93',
'C94','C95','C96','C97','14','15','16','170','171','172','200', '201','202','203','204','205','206','207','208','174','175','176',
'177','178','179','18','190','191','192','193','194','195')   or 
        dx4 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 'C12','C13','C14','C15','C16', 
'C17','C18','C19','C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40','C41','C43', 
'C45','C46','C47','C48','C49','C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65', 'C66',
'C67', 'C68','C69','C70','C71','C72','C73','C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92','C93', 'C94',
'C95','C96','C97','14','15','16','170','171','172','200', '201','202','203','204','205','206','207','208','174','175','176', '177',
'178','179','18','190','191','192','193','194','195')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_malignancy nodupkey;
    by bene_id;
    where flag = 1;
run;
data flag_malignancy_ip;
    set cms.inpatient;
    if (0 <= (index_date - clm_from_dt) <=365) and (dx1 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11',
'C12','C13','C14','C15','C16', 'C17','C18','C19','C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38',
'C39','C40','C41','C43', 'C45','C46','C47','C48','C49','C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63',
'C64','C65', 'C66','C67', 'C68','C69','C70','C71','C72','C73','C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92',
'C93', 'C94','C95','C96','C97','14','15','16','170','171','172','200', '201','202','203','204','205','206','207','208','174','175','176', 
'177','178','179','18','190','191','192','193','194','195')   or 
        dx2 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 'C12','C13','C14','C15','C16', 'C17',
'C18','C19','C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40','C41','C43', 'C45','C46',
'C47','C48','C49','C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65', 'C66','C67', 'C68','C69','C70',
'C71','C72','C73','C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92','C93', 'C94','C95','C96','C97','14','15','16','170',
'171','172','200', '201','202','203','204','205','206','207','208','174','175','176', '177','178','179','18','190','191','192','193','194','195')   or 
        dx3 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 'C12','C13','C14','C15','C16', 'C17',
'C18','C19','C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40','C41','C43', 'C45','C46',
'C47','C48','C49','C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65', 'C66','C67', 'C68','C69',
'C70','C71','C72','C73','C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92','C93', 'C94','C95','C96','C97','14','15','16',
'170','171','172','200', '201','202','203','204','205','206','207','208','174','175','176', '177','178','179','18','190','191','192','193','194','195')   or 
        dx4 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 'C12','C13','C14','C15','C16', 'C17',
'C18','C19','C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40','C41','C43', 'C45','C46','C47',
'C48','C49','C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65', 'C66','C67', 'C68','C69','C70','C71',
'C72','C73','C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92','C93', 'C94','C95','C96','C97','14','15','16','170','171',
'172','200', '201','202','203','204','205','206','207','208','174','175','176', '177','178','179','18','190','191','192','193','194','195')   or
        dx5 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 'C12','C13','C14','C15','C16', 'C17','C18',
'C19','C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40','C41','C43', 'C45','C46','C47','C48',
'C49','C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65', 'C66','C67', 'C68','C69','C70','C71',
'C72','C73','C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92','C93', 'C94','C95','C96','C97','14','15','16','170',
'171','172','200', '201','202','203','204','205','206','207','208','174','175','176', '177','178','179','18','190','191','192','193','194','195')   or
        dx6 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 'C12','C13','C14','C15','C16', 'C17','C18',
'C19','C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40','C41','C43', 'C45','C46','C47','C48',
'C49','C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65', 'C66','C67', 'C68','C69','C70','C71','C72',
'C73','C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92','C93', 'C94','C95','C96','C97','14','15','16','170','171','172',
'200', '201','202','203','204','205','206','207','208','174','175','176', '177','178','179','18','190','191','192','193','194','195')   or
        dx7 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 'C12','C13','C14','C15','C16', 'C17','C18','C19',
'C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40','C41','C43', 'C45','C46','C47','C48','C49',
'C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65', 'C66','C67', 'C68','C69','C70','C71','C72','C73',
'C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92','C93', 'C94','C95','C96','C97','14','15','16','170','171','172','200',
'201','202','203','204','205','206','207','208','174','175','176', '177','178','179','18','190','191','192','193','194','195')   or
        dx8 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 'C12','C13','C14','C15','C16', 'C17','C18',
'C19','C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40','C41','C43', 'C45','C46','C47','C48',
'C49','C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65', 'C66','C67', 'C68','C69','C70','C71','C72',
'C73','C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92','C93', 'C94','C95','C96','C97','14','15','16','170','171','172',
'200', '201','202','203','204','205','206','207','208','174','175','176', '177','178','179','18','190','191','192','193','194','195')   or
        dx9 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 'C12','C13','C14','C15','C16', 'C17','C18',
'C19','C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40','C41','C43', 'C45','C46','C47','C48',
'C49','C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65', 'C66','C67', 'C68','C69','C70','C71',
'C72','C73','C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92','C93', 'C94','C95','C96','C97','14','15','16','170',
'171','172','200', '201','202','203','204','205','206','207','208','174','175','176', '177','178','179','18','190','191','192','193','194','195')   or
        dx10 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 'C12','C13','C14','C15','C16', 'C17',
'C18','C19','C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40','C41','C43', 'C45','C46','C47',
'C48','C49','C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65', 'C66','C67', 'C68','C69','C70','C71',
'C72','C73','C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92','C93', 'C94','C95','C96','C97','14','15','16','170','171',
'172','200', '201','202','203','204','205','206','207','208','174','175','176', '177','178','179','18','190','191','192','193','194','195')   or
        dx11 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 'C12','C13','C14','C15','C16', 'C17','C18',
'C19','C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40','C41','C43', 'C45','C46','C47','C48',
'C49','C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65', 'C66','C67', 'C68','C69','C70','C71',
'C72','C73','C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92','C93', 'C94','C95','C96','C97','14','15','16','170',
'171','172','200', '201','202','203','204','205','206','207','208','174','175','176', '177','178','179','18','190','191','192','193','194','195')   or
        dx12 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 'C12','C13','C14','C15','C16', 'C17','C18',
'C19','C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40','C41','C43', 'C45','C46','C47','C48',
'C49','C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65', 'C66','C67', 'C68','C69','C70','C71','C72',
'C73','C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92','C93', 'C94','C95','C96','C97','14','15','16','170','171','172',
'200', '201','202','203','204','205','206','207','208','174','175','176', '177','178','179','18','190','191','192','193','194','195')   or
        dx13 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 'C12','C13','C14','C15','C16', 'C17','C18',
'C19','C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40','C41','C43', 'C45','C46','C47','C48',
'C49','C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65', 'C66','C67', 'C68','C69','C70','C71','C72',
'C73','C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92','C93', 'C94','C95','C96','C97','14','15','16','170','171','172',
'200', '201','202','203','204','205','206','207','208','174','175','176', '177','178','179','18','190','191','192','193','194','195')   or
        dx14 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 'C12','C13','C14','C15','C16', 'C17','C18',
'C19','C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40','C41','C43', 'C45','C46','C47','C48',
'C49','C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65', 'C66','C67', 'C68','C69','C70','C71','C72',
'C73','C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92','C93', 'C94','C95','C96','C97','14','15','16','170','171','172',
'200', '201','202','203','204','205','206','207','208','174','175','176', '177','178','179','18','190','191','192','193','194','195')   or
        dx15 in: ('2386','C00','C01','C02','C03','C04','C05','C06','C07','C08','C09','C10','C11', 'C12','C13','C14','C15','C16', 'C17','C18',
'C19','C20','C21','C22','C23', 'C24','C25','C26','C30','C31','C32','C33','C34','C37','C38','C39','C40','C41','C43', 'C45','C46','C47','C48',
'C49','C50','C51','C52','C53','C54',   'C55','C56','C57','C58','C60','C61','C62','C63','C64','C65', 'C66','C67', 'C68','C69','C70','C71','C72',
'C73','C74','C75','C76','C81','C82','C83', 'C84','C85','C88','C90','C91','C92','C93', 'C94','C95','C96','C97','14','15','16','170','171','172',
'200', '201','202','203','204','205','206','207','208','174','175','176', '177','178','179','18','190','191','192','193','194','195')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_malignancy_ip nodupkey;
    by bene_id;
    where flag = 1;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_malignancy(in=b);
    by bene_id;
    if b then malignancy_op = 1;
    else malignancy_op = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_malignancy_ip(in=b);
    by bene_id;
    if b then malignancy_ip = 1;
    else malignancy_ip = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    set cms.study_cohort_v2;
    if (malignancy_ip = 1 or malignancy_op = 1) then malignancy = 1; else malignancy = 0;
    drop malignancy_ip malignancy_op;
run;


//////////////////AIDS///////////////
/*AIDS*/
data flag_aids;
    set cms.outpatient;
    if (0 <= (index_date - svcdate) <=365) and (dx1 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or 
        dx2 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or 
        dx3 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or 
        dx4 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_aids nodupkey;
    by bene_id;
    where flag = 1;
run;
data flag_aids_ip;
    set cms.inpatient;
    if (0 <= (index_date - clm_from_dt) <=365) and (dx1 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or 
        dx2 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or 
        dx3 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or 
        dx4 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or
        dx5 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or
        dx6 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or
        dx7 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or
        dx8 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or
        dx9 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or
        dx10 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or
        dx11 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or
        dx12 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or
        dx13 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or
        dx14 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')   or
        dx15 in: ('B20','B21','B220','B221','B222', 'B24', '042','043','044')  ) then flag = 1;
    else flag = 0;
    keep bene_id flag;
run;
proc sort data=flag_aids_ip nodupkey;
    by bene_id;
    where flag = 1;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_aids(in=b);
    by bene_id;
    if b then aids_op = 1;
    else aids_op = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    merge cms.study_cohort_v2(in=a) flag_aids_ip(in=b);
    by bene_id;
    if b then aids_ip = 1;
    else aids_ip = 0;
    drop flag;
run;
data cms.study_cohort_v2;
    set cms.study_cohort_v2;
    if (aids_ip = 1 or aids_op = 1) then aids = 1; else aids = 0;
    drop aids_ip aids_op;
run;
